<!DOCTYPE html>
<html lang="fr">
<body>
    <h2>üîç Scanner de Colonnes</h2>
    <div id="result" style="font-family:monospace; background:#eee; padding:20px;">Chargement...</div>

    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
    <script>
        grist.ready({ requiredAccess: 'full' });
        grist.onRecords(async () => {
            const tablesToCheck = ['TACHES_MASTER', 'AGENTS', 'PROJETS', 'EQUIPES'];
            let html = "";

            for (const tableName of tablesToCheck) {
                try {
                    const data = await grist.docApi.fetchTable(tableName);
                    // On r√©cup√®re les cl√©s (noms de colonnes) du premier objet
                    const columns = Object.keys(data).filter(k => k !== 'id' && k !== 'manualSort');
                    
                    html += `<p><strong>TABLE : ${tableName}</strong><br>`;
                    html += `Colonnes trouv√©es : <span style="color:blue">${columns.join(', ')}</span></p>`;
                    
                    // Affiche un exemple de ligne pour v√©rifier le contenu
                    if (data.id.length > 0) {
                        let sample = {};
                        columns.forEach(c => sample[c] = data[c][0]);
                        html += `<small>Exemple de donn√©e : ${JSON.stringify(sample)}</small><br><hr>`;
                    } else {
                        html += `<small style="color:orange">Table vide (pas de lignes)</small><hr>`;
                    }

                } catch (e) {
                    html += `<p style="color:red"><strong>ERREUR TABLE ${tableName}</strong> : Introuvable ou nom incorrect.</p><hr>`;
                }
            }
            document.getElementById('result').innerHTML = html;
        });
    </script>
</body>
</html>
